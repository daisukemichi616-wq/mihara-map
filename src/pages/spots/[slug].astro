---
import Layout from '../../layouts/Layout.astro';
import { fetchSpots } from '../../utils/google-sheets';

export async function getStaticPaths() {
    const allSpots = await fetchSpots();
    return allSpots.map((spot) => ({ params: { slug: spot.slug }, props: { spot } }));
}
const { spot } = Astro.props;
---
<Layout title={spot.title} description={spot.description} image={spot.imageUrl}>
    <nav class="fixed-nav">
        <div class="header-logo"><a href="/" style="text-decoration:none; color:inherit;"><i class="fa-solid fa-arrow-left"></i> MAPに戻る</a></div>
        <div class="header-logo">MIHARA REDISCOVER</div>
        <div style="width:40px;"></div>
    </nav>

    <div style="background-color:rgba(0,0,0,0.5); min-height:100vh; padding: 80px 20px; display:flex; justify-content:center; align-items:start;">
        <div id="modal-content-area" class="w-full max-w-[600px] bg-white shadow-2xl rounded-lg overflow-hidden relative">
            <img src={spot.imageUrl} class="w-full aspect-square object-cover">
            
            <div class="px-8 py-12 text-left">
                <span id="modal-area" class="text-[9px] font-bold tracking-widest text-blue-600 border border-blue-600 px-3 py-1 mb-6 inline-block uppercase">{spot.areaLabel}</span>
                <h1 id="modal-title" class="serif-custom text-2xl mb-4 leading-normal text-slate-800">{spot.title}</h1>
                <p id="modal-desc" class="text-sm font-medium leading-loose mb-8 text-slate-600 whitespace-pre-wrap">{spot.description}</p>
                
                <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent("三原市 " + spot.title)}`} target="_blank" class="mb-10 flex items-center justify-center gap-2 w-full border border-blue-900 text-blue-900 font-bold text-xs py-4 rounded hover:bg-blue-50 transition">
                    <i class="fa-solid fa-location-dot"></i> この場所をGoogleマップで見る
                </a>

                <div class="flex items-center justify-between border-t border-slate-200 pt-8">
                    <span id="modal-author" class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">PHOTO BY {spot.authorName}</span>
                    {spot.snsUrl ? (
                        <a id="modal-sns" href={spot.snsUrl} target="_blank" class="text-gray-900 font-bold text-[10px] border-b border-gray-900 pb-1 uppercase hover:opacity-70 transition">Instagram Link</a>
                    ) : (
                        <span class="text-gray-300 text-[10px] font-bold uppercase">No SNS Account</span>
                    )}
                </div>
            </div>
        </div>
    </div>

    <script is:inline define:vars={{r_title: spot.rpg_title, r_desc: spot.rpg_desc}}>
        if (localStorage.getItem('rpg-mode') === 'true') {
            document.body.classList.add('rpg-mode');
            if (r_title) document.getElementById('modal-title').textContent = r_title;
            if (r_desc) document.getElementById('modal-desc').innerHTML = r_desc.replace(/\n/g, '<br>');
        }
    </script>
</Layout>