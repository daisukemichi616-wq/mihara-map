---
const { title, description, image } = Astro.props;
const siteTitle = "三原市まち歩き - PHOTO MAP | 三原市の魅力を再発見するプロジェクト";
const pageTitle = title ? `${title} | 三原市まち歩き` : siteTitle;
const desc = description || "広島県三原市の魅力を再発見するフォトマッププロジェクト。地元の人だけが知る絶景や隠れたスポットを写真と地図で紹介しています。";
const img = image || "https://i.postimg.cc/Dy2sThhC/IMG-9586.jpg";
---
<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LGXBBWLCPN"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-LGXBBWLCPN');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="referrer" content="no-referrer">

    <!-- SEO & OGP -->
    <title>{pageTitle}</title>
    <meta name="description" content={desc}>
    <meta property="og:title" content={pageTitle}>
    <meta property="og:description" content={desc}>
    <meta property="og:image" content={img}>
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&family=Noto+Serif+JP:wght@700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    
    <!-- CSS / Icons (Tailwind CDNを確実に読み込む) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <!-- ★元のスタイルをそのまま記述 -->
    <style is:global>
        :root {
            --palette-blue: #004098;
            --palette-blue-light: #e1f5fe;
            --palette-sky: #f0f7ff;
            --palette-gold: #f5d76e;
            --text-main: #1a1a1a;
            --text-sub: #4b5563;
            --border-soft: #e2e8f0;
        }

        html { scroll-behavior: smooth; }

        /* --- 字体の徹底統一設定 --- */
        *:not(i):not(svg):not(polyline):not(rect):not(path):not(circle):not(line) {
            font-family: 'Zen Maru Gothic', sans-serif !important;
            font-weight: 500;
        }

        .serif-custom {
            font-family: 'Noto Serif JP', serif !important;
            font-weight: 700 !important;
        }

        body {
            color: var(--text-main);
            background-color: #fff;
            margin: 0;
            padding-top: 60px;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            line-height: 1.8;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- ナビゲーション --- */
        .fixed-nav {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-soft);
            z-index: 9999;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px;
            transition: all 0.5s ease;
        }
        .header-logo { font-weight: 700 !important; font-size: 0.8rem; color: var(--palette-blue); letter-spacing: 0.05em; }
        .nav-links-wrap { display: flex; gap: 10px; align-items: center; }
        .nav-simple-link {
            font-size: 10px; font-weight: 700 !important; color: #9ca3af; cursor: pointer; transition: color 0.2s;
            text-decoration: none; white-space: nowrap;
        }
        .nav-simple-link:active, .nav-simple-link:hover { color: var(--palette-blue); }

        @media (min-width: 640px) {
            .header-logo { font-size: 1rem; letter-spacing: 0.1em; }
            .nav-links-wrap { gap: 20px; }
            .nav-simple-link { font-size: 12px; }
        }

        /* --- RPGスイッチ --- */
        #rpg-toggle-btn {
            background: var(--palette-blue);
            border: 1px solid var(--palette-blue);
            color: white;
            font-family: 'Zen Maru Gothic', sans-serif;
            padding: 6px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 10px;
            font-weight: 700;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 4px;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0, 64, 152, 0.2); 
        }
        #rpg-toggle-btn:hover { background: #00337a; transform: translateY(-1px); }
        #rpg-toggle-btn i { color: var(--palette-gold); font-size: 12px; }

        @media (max-width: 640px) {
            .nav-simple-link { font-size: 9px; }
            .nav-links-wrap { gap: 6px; } 
            #rpg-toggle-btn { padding: 5px 10px; font-size: 9px; }
            @media (max-width: 370px) {
                .header-logo { display: none; } 
                .fixed-nav { justify-content: center; }
            }
        }

        /* --- ヒーロー --- */
        .hero-view {
            position: relative; width: 100%; height: 80vh; height: 80dvh;
            background-color: #f7f7f7; overflow: hidden;
        }
        .slider-container { position: absolute; inset: 0; z-index: 1; }
        .slide { position: absolute; inset: 0; opacity: 0; transition: opacity 2s ease-in-out; }
        .slide.active { opacity: 1; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        
        .hero-overlay { position: absolute; inset: 0; background: radial-gradient(circle, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.3) 100%); z-index: 2; }
        .hero-content { position: relative; z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; color: white; padding: 0 20px; text-align: center; }
        .hero-label { font-size: 0.75rem; font-weight: 700 !important; letter-spacing: 0.4em; color: var(--palette-gold); margin-bottom: 25px; display: block; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }
        .hero-title { font-size: 1.65rem; line-height: 1.8; text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 2px 10px rgba(0,0,0,0.5); }
        .mobile-br { display: block; }
        @media (min-width: 640px) { .hero-title { font-size: 2.8rem; line-height: 1.6; } .mobile-br { display: none; } }

        /* --- セクション --- */
        .section-wrap { padding: 100px 24px; scroll-margin-top: 60px; position: relative; transition: background-color 0.5s ease; }
        .inner-limit { max-width: 750px; margin: 0 auto; text-align: center; }
        .section-tag-label { font-size: 0.8rem; font-weight: 700 !important; color: var(--palette-blue); letter-spacing: 0.25em; margin-bottom: 40px; display: block; text-transform: uppercase; }

        .card-frame { 
            background: white; border-radius: 12px; padding: 40px 25px; margin-bottom: 30px; text-align: left; 
            border: 1px solid var(--border-soft); box-shadow: 0 10px 30px rgba(0,64,152,0.03); 
            transition: all 0.5s ease;
        }
        .card-frame h4 { font-weight: 700 !important; color: var(--palette-blue); margin-bottom: 12px; font-size: 1rem; border-left: 5px solid var(--palette-blue); padding-left: 15px; }
        .card-frame p { font-size: 0.85rem; font-weight: 500 !important; line-height: 2.3; color: var(--text-sub); }

        /* --- ギャラリー / MAP --- */
        .sticky-tab-bar { position: sticky; top: 60px; background: rgba(255,255,255,0.98); z-index: 900; border-bottom: 2px solid var(--palette-blue); overflow-x: auto; white-space: nowrap; transition: all 0.5s ease; }
        .sticky-tab-bar::-webkit-scrollbar { display: none; }
        .tab-flex { display: flex; padding: 0 10px; justify-content: center; }
        .tab-item { padding: 22px 18px; font-size: 0.85rem; font-weight: 700 !important; color: #9ca3af; border-bottom: 4px solid transparent; cursor: pointer; }
        .tab-item.active { color: var(--palette-blue); border-bottom-color: var(--palette-blue); }
        @media (max-width: 640px) { .tab-flex { justify-content: flex-start; } }

        .view-switch { display: inline-flex; background: #f1f5f9; padding: 4px; border-radius: 50px; margin-bottom: 20px; transition: all 0.5s ease; }
        .view-btn { padding: 8px 24px; border-radius: 40px; font-size: 11px; font-weight: 700; cursor: pointer; transition: all 0.3s; color: #64748b; display: flex; align-items: center; }
        .view-btn.active { background: white; color: var(--palette-blue); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: var(--border-soft); }
        @media (min-width: 768px) { .photo-grid { grid-template-columns: repeat(4, 1fr); } }
        
        .photo-item { position: relative; aspect-ratio: 1/1; background: #f3f4f6; overflow: hidden; cursor: pointer; display: block; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .photo-overlay {
            position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 80%);
            opacity: 0; transition: opacity 0.6s ease; display: flex; flex-direction: column; justify-content: flex-end; padding: 10px; pointer-events: none;
        }
        .photo-overlay span { transform: translateY(15px); opacity: 0; transition: transform 0.6s, opacity 0.6s ease; }
        @media (hover: hover) {
            .photo-item:hover img { transform: scale(1.1); }
            .photo-item:hover .photo-overlay { opacity: 1; }
            .photo-item:hover .photo-overlay span { transform: translateY(0); opacity: 1; }
        }
        @media (hover: none) {
            .photo-item .photo-overlay { opacity: 1; }
            .photo-item .photo-overlay span { transform: translateY(0); opacity: 1; }
        }

        #map-container { height: 60vh; min-height: 500px; width: 100%; z-index: 1; display: none; border-bottom: 1px solid var(--border-soft); }
        #map-container.active { display: block; }

        .leaflet-popup-content-wrapper { border-radius: 8px; overflow: hidden; padding: 0; box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .leaflet-popup-content { margin: 0; width: 220px !important; }
        
        /* --- 募集 --- */
        .h2-one-line { font-size: 1.6rem; font-weight: 700 !important; margin-bottom: 50px; line-height: 1.2; text-align: center; white-space: nowrap; letter-spacing: -0.07em; color: var(--palette-blue); }
        @media (max-width: 380px) { .h2-one-line { font-size: 1.25rem; } }
        .insta-cta-box {
            margin-top: 60px; padding: 40px 20px; background: #fff; border: 2px dashed var(--palette-blue-light); border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; gap: 20px; transition: all 0.5s ease;
        }
        .insta-btn-final {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            color: white !important; padding: 18px 45px; border-radius: 100px;
            font-weight: 700 !important; text-decoration: none; font-size: 1rem;
            box-shadow: 0 10px 25px rgba(220, 39, 67, 0.25); white-space: nowrap; 
        }

        /* --- 画像パーツ --- */
        .img-divider-box { position: relative; width: 100%; height: auto; min-height: 320px; aspect-ratio: 16/9; overflow: hidden; border-top: 1px solid var(--border-soft); border-bottom: 1px solid var(--border-soft); background: #f3f4f6; }
        .img-divider-box img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        .img-divider-content { position: relative; z-index: 2; height: 100%; display: flex; align-items: flex-end; padding: 25px; }

        .bottom-view-container { position: relative; width: 100%; height: auto; min-height: 450px; aspect-ratio: 4/5; overflow: hidden; border-top: 1px solid var(--border-soft); background: #f3f4f6; }
        @media (min-width: 640px) { .bottom-view-container { aspect-ratio: 16/7; } }
        .bottom-view-container img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        .bottom-view-overlay { position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 50px; }
        .floating-badge { background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 20px 35px; text-align: center; border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; }

        .footer-main { text-align: center; background-color: #fff; border-top: 1px solid var(--border-soft); padding: 60px 20px 60px 20px; transition: background-color 0.5s ease; }
        .footer-copy { font-size: 9px; font-weight: 700 !important; color: #9ca3af; letter-spacing: 0.3em; margin-bottom: 12px; text-transform: uppercase; }
        .footer-produced { font-size: 8px; font-weight: 500 !important; color: #cbd5e1; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 8px; }
        .footer-note { font-size: 8px; font-weight: 500 !important; color: #cbd5e1; letter-spacing: 0.05em; }

        /* --- RPG MODE --- */
        body.rpg-mode { background-color: #000 !important; color: #fff !important; font-family: 'DotGothic16', sans-serif !important; }
        body.rpg-mode *:not(i) { font-family: 'DotGothic16', sans-serif !important; letter-spacing: 0.1em; }
        body.rpg-mode img { filter: none; image-rendering: auto; }
        body.rpg-mode .leaflet-layer { filter: contrast(120%) saturate(200%); image-rendering: pixelated; }
        
        body.rpg-mode .card-frame, body.rpg-mode .fixed-nav, body.rpg-mode .sticky-tab-bar, 
        body.rpg-mode .popup-info, body.rpg-mode .insta-cta-box, body.rpg-mode .footer-main, 
        body.rpg-mode .section-wrap:nth-child(even) {
            background: #00008b !important; border: 3px double #fff !important; border-radius: 4px !important; color: #fff !important; box-shadow: 0 0 0 2px #000;
        }
        body.rpg-mode .section-wrap { background-color: #000 !important; }
        body.rpg-mode #contact { border-top: none !important; }
        body.rpg-mode h1, body.rpg-mode h2, body.rpg-mode h3, body.rpg-mode h4, body.rpg-mode h5, body.rpg-mode p, body.rpg-mode span, body.rpg-mode a, body.rpg-mode div, body.rpg-mode li { color: #fff !important; text-shadow: 2px 2px 0 #000; }
        body.rpg-mode .text-blue-900, body.rpg-mode .section-tag-label, body.rpg-mode h4, body.rpg-mode #modal-area, body.rpg-mode #modal-sns { color: #f5d76e !important; border-color: #f5d76e !important; }
        body.rpg-mode .view-switch { background: #000 !important; }
        body.rpg-mode .view-btn, body.rpg-mode .tab-item { background: #000 !important; border: 2px solid #fff !important; color: #fff !important; margin: 2px; }
        body.rpg-mode .view-btn.active, body.rpg-mode .tab-item.active { background: #a52a2a !important; color: #ff0 !important; border-color: #ff0 !important; }
        body.rpg-mode #rpg-toggle-btn { background: #000 !important; border: 2px solid #fff !important; color: #fff !important; font-family: 'DotGothic16', sans-serif !important; }
        body.rpg-mode #about { padding-bottom: 40px !important; }
        body.rpg-mode #gallery { padding-top: 60px !important; }
        body.rpg-mode #sub-map { color: #1a1a1a !important; text-shadow: none; }
    </style>
</head>
<body id="top">
    <slot />
    
    <script is:inline>
        if (localStorage.getItem('rpg-mode') === 'true') {
            document.body.classList.add('rpg-mode');
        }
    </script>
</body>
</html>