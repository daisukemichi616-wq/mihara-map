---
const { title, description, image } = Astro.props;
const siteTitle = "三原市まち歩き - PHOTO MAP";
const fullTitle = title ? `${title} | ${siteTitle}` : siteTitle;
const desc = description || "広島県三原市の魅力を再発見するフォトマッププロジェクト。";
const img = image || "https://i.postimg.cc/Dy2sThhC/IMG-9586.jpg";
---
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <!-- SEO -->
    <title>{fullTitle}</title>
    <meta name="description" content={desc}>
    <meta property="og:title" content={fullTitle}>
    <meta property="og:description" content={desc}>
    <meta property="og:image" content={img}>
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <!-- ★重要: 確実にデザインを適用するためにCDNを使用 -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&family=Noto+Serif+JP:wght@700;900&family=DotGothic16&display=swap" rel="stylesheet">
    
    <!-- Icons & Leaflet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <!-- ★元のCSSをここに完全移植 -->
    <style is:global>
        :root {
            --palette-blue: #004098;
            --palette-blue-light: #e1f5fe;
            --palette-sky: #f0f7ff;
            --palette-gold: #f5d76e;
            --text-main: #1a1a1a;
            --text-sub: #4b5563;
            --border-soft: #e2e8f0;
        }

        html { scroll-behavior: smooth; }

        /* --- 字体の徹底統一設定 --- */
        *:not(i):not(svg):not(polyline):not(rect):not(path):not(circle):not(line) {
            font-family: 'Zen Maru Gothic', sans-serif !important;
            font-weight: 500;
        }

        .serif-custom {
            font-family: 'Noto Serif JP', serif !important;
            font-weight: 700 !important;
        }

        body {
            color: var(--text-main);
            background-color: #fff;
            margin: 0;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            line-height: 1.8;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- ナビゲーション --- */
        .fixed-nav {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-soft);
            z-index: 9999;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px;
            transition: all 0.5s ease;
        }
        .header-logo { font-weight: 700 !important; font-size: 0.8rem; color: var(--palette-blue); letter-spacing: 0.05em; }
        .nav-links-wrap { display: flex; gap: 10px; align-items: center; }
        .nav-simple-link {
            font-size: 10px; font-weight: 700 !important; color: #9ca3af; cursor: pointer; transition: color 0.2s;
            text-decoration: none; white-space: nowrap;
        }
        .nav-simple-link:active, .nav-simple-link:hover { color: var(--palette-blue); }

        @media (min-width: 640px) {
            .header-logo { font-size: 1rem; letter-spacing: 0.1em; }
            .nav-links-wrap { gap: 20px; }
            .nav-simple-link { font-size: 12px; }
        }

        /* RPGスイッチ */
        #rpg-toggle-btn {
            background: var(--palette-blue); border: 1px solid var(--palette-blue); color: white;
            font-family: 'Zen Maru Gothic', sans-serif; padding: 6px 14px; border-radius: 20px;
            cursor: pointer; font-size: 10px; font-weight: 700; transition: all 0.3s;
            display: flex; align-items: center; gap: 6px; margin-left: 4px; white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0, 64, 152, 0.2); 
        }
        #rpg-toggle-btn:hover { background: #00337a; transform: translateY(-1px); }

        /* セクション */
        .section-wrap { padding: 100px 24px; scroll-margin-top: 60px; position: relative; transition: background-color 0.5s ease; }
        .inner-limit { max-width: 750px; margin: 0 auto; text-align: center; }
        .section-tag-label { font-size: 0.8rem; font-weight: 700 !important; color: var(--palette-blue); letter-spacing: 0.25em; margin-bottom: 40px; display: block; text-transform: uppercase; }

        .card-frame { 
            background: white; border-radius: 12px; padding: 40px 25px; margin-bottom: 30px; text-align: left; 
            border: 1px solid var(--border-soft); box-shadow: 0 10px 30px rgba(0,64,152,0.03); 
            transition: all 0.5s ease;
        }
        .card-frame h4 { font-weight: 700 !important; color: var(--palette-blue); margin-bottom: 12px; font-size: 1rem; border-left: 5px solid var(--palette-blue); padding-left: 15px; }

        /* ギャラリー / MAP */
        .sticky-tab-bar { position: sticky; top: 60px; background: rgba(255,255,255,0.98); z-index: 900; border-bottom: 2px solid var(--palette-blue); overflow-x: auto; white-space: nowrap; transition: all 0.5s ease; }
        .tab-flex { display: flex; padding: 0 10px; justify-content: center; }
        .tab-item { padding: 22px 18px; font-size: 0.85rem; font-weight: 700 !important; color: #9ca3af; border-bottom: 4px solid transparent; cursor: pointer; }
        .tab-item.active { color: var(--palette-blue); border-bottom-color: var(--palette-blue); }

        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: var(--border-soft); }
        @media (min-width: 768px) { .photo-grid { grid-template-columns: repeat(4, 1fr); } }
        
        .photo-item { position: relative; aspect-ratio: 1/1; background: #f3f4f6; overflow: hidden; cursor: pointer; display: block; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s; }
        .photo-item:hover img { transform: scale(1.1); }
        
        /* 募集セクション */
        .h2-one-line { font-size: 1.6rem; font-weight: 700 !important; margin-bottom: 50px; line-height: 1.2; text-align: center; color: var(--palette-blue); }
        .insta-cta-box { margin-top: 60px; padding: 40px 20px; background: #fff; border: 2px dashed var(--palette-blue-light); border-radius: 20px; text-align: center; }
        .insta-btn-final {
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            color: white !important; padding: 18px 45px; border-radius: 100px;
            font-weight: 700 !important; text-decoration: none; font-size: 1rem;
            margin-top: 20px;
        }

        /* RPGモード */
        body.rpg-mode {
            background-color: #000 !important; color: #fff !important; font-family: 'DotGothic16', sans-serif !important;
        }
        body.rpg-mode *:not(i) { font-family: 'DotGothic16', sans-serif !important; letter-spacing: 0.1em; }
        body.rpg-mode .card-frame, body.rpg-mode .fixed-nav, body.rpg-mode .sticky-tab-bar, 
        body.rpg-mode .footer-main, body.rpg-mode .section-wrap:nth-child(even), body.rpg-mode .insta-cta-box {
            background: #00008b !important; border: 3px double #fff !important; border-radius: 4px !important; color: #fff !important; box-shadow: 0 0 0 2px #000;
        }
        body.rpg-mode .section-wrap { background-color: #000 !important; }
        body.rpg-mode h1, body.rpg-mode h2, body.rpg-mode h3, body.rpg-mode p, body.rpg-mode span, body.rpg-mode a {
            color: #fff !important; text-shadow: 2px 2px 0 #000;
        }
        body.rpg-mode .text-blue-900, body.rpg-mode .section-tag-label { color: #f5d76e !important; }
        
        /* Leaflet Popups */
        .leaflet-popup-content-wrapper { border-radius: 8px; padding: 0; }
        .leaflet-popup-content { margin: 0; width: 220px !important; }
    </style>
</head>
<body id="top">
    <slot />
    
    <script>
        if (localStorage.getItem('rpg-mode') === 'true') {
            document.body.classList.add('rpg-mode');
        }
    </script>
</body>
</html>